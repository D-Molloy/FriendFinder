<!DOCTYPE html>
<html>
<head>
    <title>Survey - FriendFinder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  
    <!-- newest jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Kalam|Roboto|Rock+Salt" rel="stylesheet">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>

    <link type="text/css" rel="stylesheet" href="css/style.css"/>


</head>
<body>

    <div class="parallax-container">
        <div class="parallax"><img src="assets/friends-top.jpg"></div>
        <p id="banner-title">FriendFinder</p>
    </div>
    <div class="section white">
        <div class="row container center-align">
            <h2 class="header main-tag">Your new <b><i>SFF</i></b> (that's <b><i>SoulFriend</i></b>&reg;<i>Forever</i>) is just a few questions away...</h2>
            <hr>
        </div>

        

        <form class="col s12">
                <div class="row container">
                        <h5>Enter some info about yourself:</h5>
                  <div class="input-field col s6">
                    <input placeholder="Pat Person" id="user-name" type="text" class="validate form-control" required="">
                    <label for="user-name" data-error="Please Enter Your Name" data-success="Name Entered">Your Name</label>
                  </div>
                </div>
                <div class="row container">
                    <div class="input-field col s6">
                        <input placeholder="Right-click on image > select 'Copy Image Address' > paste link here." id="user-url" type="text" class="validate form-control" required="">
                        <label for="user-url" data-error="Please Enter A Link To Your Picture" data-success="Link Entered">Paste a link to your picture</label>
                    </div>
                </div>
        </form>


        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#1: I find comfort in the saying "Live. Laugh. Love."</p>
                <select class="icons" id="q1">
                    <option value="" disabled selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#2: If people have different views than me, I don't want them to be around me and they should leave.</p>
                <select class="icons" id="q2">
                    <option value="" disabled selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#3: The Alt-Right is all right with me.</p>
                <select class="icons" id="q3">
                    <option value="" disabled selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#4: A hot dog (with bun) is technically a sandwich.</p>
                <select class="icons" id="q4">
                    <option value="" disabled selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#5: There is nothing wrong with the 2-party political system in U.S. politics.</p>
                <select class="icons" id="q5">
                    <option value="" disabled selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#6: My dream vacation is glamping at Coachella.</p>
                <select class="icons" id="q6">
                    <option value="" disabled selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#7: I have more friends of the opposite sex than I do of my own sex.</p>
                <select class="icons" id="q7">
                    <option value="" disabled selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#8: There is nothing like a good cuddle.</p>
                <select class="icons" id="q8">
                    <option value="" disabled selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#9: I hate kids.</p>
                <select class="icons" id="q9">
                    <option value="" disabled selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <div class="input-field col s12">
                <p class="quest-text left-align">#10: I'd rather have a friend tell me the truth than protect my feelings.</p>
                <select class="icons" id="q10">
                    <option value=""  selected>Select your answer...</option>
                    <option value="5" data-icon="assets/5.png" class="left circle">Completely Agree</option>
                    <option value="4" data-icon="assets/4.png" class="left circle">Somewhat Agree</option>
                    <option value="3" data-icon="assets/3.png" class="left circle">Neutral</option>
                    <option value="2" data-icon="assets/2.png" class="left circle">Somewhat Disagree</option>
                    <option value="1" data-icon="assets/1.png" class="left circle">Completely Disagree</option>
                </select>
            </div>
        </div>

        <div class="row container center-align">
            <button class="waves-effect waves-light btn-large light-blue darken-4" type="submit" name="get-started" id="submit"><i class="material-icons left">location_searching</i>Find your SoulFriend&reg;!</button>
        </div>
        <div class="row container center-align">
            <a class="blue-text text-lighten-3" href="/api/friends">API Friends List</a>  <span class="blue-text text-lighten-3">  |  </span>
            <a class="blue-text text-lighten-3" href="/">Home</a>
         </div>

    </div>
    <div class="parallax-container">
        <div class="parallax"><img src="assets/friends.jpg"></div>
    </div>

<!-- add modal  -->
 
    <footer class="page-footer light-blue darken-4">
        <div class="container center-align ">
            © 2017 Denis Molloy
        </div>
    </footer>
    <script type="text/javascript" src="app.js"></script>
    <script type="text/javascript">
// 6. Determine the user's most compatible friend using the following as a guide:

//    * Convert each user's results into a simple array of numbers (ex: `[5, 1, 4, 4, 5, 1, 2, 5, 4, 1]`).
//    * With that done, compare the difference between current user's scores against those from other users, question by question. Add up the differences to calculate the `totalDifference`.
//      * Example: 
//        * User 1: `[5, 1, 4, 4, 5, 1, 2, 5, 4, 1]`
//        * User 2: `[3, 2, 6, 4, 5, 1, 2, 5, 4, 1]`
//        * Total Difference: **2 + 1 + 2 =** **_5_**
//    * Remember to use the absolute value of the differences. Put another way: no negative solutions! Your app should calculate both `5-3` and `3-5` as `2`, and so on. 
//    * The closest match will be the user with the least amount of difference.

// 7. Once you've found the current user's most compatible friend, display the result as a modal pop-up.
//    * The modal should display both the name and picture of the closest match. 

        $(document).ready(function(){
            $('.parallax').parallax();
            $('select').material_select();
        });

        $('#submit').on("click", function(){
            function validateForm() {
            var isValid = true;
            $('.form-control').each(function() {
                if ( $(this).val() === '' )
                    isValid = false;
            });

            $('.chosen-select').each(function() {

                if( $(this).val() === "")
                    isValid = false
            })
            return isValid;
            }


            
            if (validateForm() == true) {
                var userData = {
                    name: $('#user-name').val().trim(),
                    photo: $('#user-url').val().trim(),
                    scores: [$('#q1').val(), $("#q2").val(), $("#q3").val(), $("#q4").val(), $("#q5").val(), $("#q6").val(), $("#q7").val(), $("#q8").val(), $("#q9").val(), $("#q10").val()]
                }


                var currentURL = window.location.origin;

                //save current user score array into a variable
                var newUserScoreArr = userData.scores;

                

                var friendDiffArr = [];

                $.ajax({url: currentURL + "/api/friends", method: "GET"})
                    .done(function(friendsData){
                    console.log("friendsData:" + friendsData)
                    
                    
                    for (var i = 0; i < friendsData.length; i++) {
                        var currDiffArr = [];
                        var indexTally = 0;
                        for(var j = 0; j < 10; j++){
                            var compareIndex = parseInt(friendsData[i].scores[j]);
                            console.log("compareIndex: " + compareIndex);
                            var userIndex = parseInt(newUserScoreArr[j]);
                            console.log("userIndex: " + userIndex);
                            var indexDiff = Math.abs(compareIndex - userIndex);
                            console.log("indexDiff: " + indexDiff);
                            currDiffArr.push(indexDiff);
                            console.log("Curr diff array: "+currDiffArr);
                        }
                        for (var k = 0; k < currDiffArr.length; k++){
                            indexTally += currDiffArr[k];
                        }
                        friendDiffArr.push(indexTally);
                        console.log("friendDiffArr: "+friendDiffArr);
                    }
                    //find the smallest value in friend diff arr and that is the best match
                    //friendsData[smallestvalue in diffarr] name and pic
                })
                
                
                //GET request to get friends data -> store in variable
                //data[i] to get first person data[i].scores
                //data[i].scores[i] - userData.scores[i] (absolute value)
                //store value in a new array
                //total up array and assign 'total' to another array

                //once all friends have been iterated through, compare the differences for each index, smallest difference is the match
                $.post(currentURL + "/api/friends", userData)
                .done(function(data){
                    console.log(data);
                    alert("You've been added to the database!");
                })

            } else {
                alert("Silly Goose!  Please enter all the information to get your new SoulFriend!")
            }



            // if (typeof userData ==='object'){
            //     console.log("This is an object: "+ userData);
            // } else {
            //     console.log("userData is not an object");
            // }
            

            //reset form
            var select = $('select');
            $("form input").val("");
            select.prop('selectedIndex', 0); //Sets the first option as selected
            select.material_select();        //Update material select
            $('#user-name').val("");

        })
    </script>

</body>
</html>